#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

# fail fast
set -e
set -o pipefail

BIN_DIR=$(cd $(dirname $0) && pwd) # absolute path

# parse args
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

. $BIN_DIR/../lib/utils

#create the cache dir if it doesn't exist
mkdir -p $CACHE_DIR

statusn "Installing JDK..."
install_java $CACHE_DIR $BUILD_DIR
echo " version $(java_version) installed"

status "install minecraft"
MINECRAFT_DOWNLOAD_URL=`cat $BUILD_DIR/minecraft_download_url.txt`
wget -O $BUILD_DIR/minecraft.jar ${MINECRAFT_DOWNLOAD_URL:-"https://s3.amazonaws.com/Minecraft.Download/versions/1.8.4/minecraft_server.1.8.4.jar"}

status "install chisel"
wget --no-check-certificate -O $BUILD_DIR/chisel https://github.com/morikat/chisel/raw/master/chisel-bin/chisel_linux_amd64
status "check chmod command"
which chmod
#chmod u+x $BUILD_DIR/chisel
